<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/page4.css">
    <link rel="stylesheet" type="text/css" href="css/page5.css">
</head>
<body>
<audio id="myAudio" loop="loop">
  <source src="img/yinyue.mp3" type="audio/ogg">
  <source src="img/yinyue.mp3" type="audio/mpeg">
   您的浏览器不支持音乐播放器。
</audio>

<audio id="myAudioWx">
    <source src="img/wxtos.mp3" type="audio/ogg">
    <source src="img/wxtos.mp3" type="audio/mpeg">
    您的浏览器不支持音乐播放器。
</audio>
<div class="slider-wrap">
    <div class="pages page1-box">
        <div class="page1-text animated">
            <img src="img/index_t.jpg" />
            <img src="img/index_w.jpg" class="page1-w animated-s infinite shake" />
        </div>
        <div class="page1-girl animated-s bounceInDown">
            <img src="img/index_g.png" />
        </div>

        <img src="img/index_fot.jpg" class="page1-img" />
        <div class="nextIcon nextIcon1 animated infinite bounceFde">
            <img src="img/nextIcon.png" />
        </div>
    </div>


    <div class="pages page2-box" style="display:none">
        <div class="wxtitle"><img src="img/wxtitle.jpg" /></div>
        <div class="wxtos1 animated"><img src="img/wxtos_03.jpg" /></div>
        <div class="wxtos2 animated"><img src="img/wxtos_06.jpg" /></div>
        <div class="wxtos3 animated"><img src="img/wxtos_08.jpg" /></div>
        <div class="wxtos4 animated"><img src="img/wxtos_10.jpg" /></div>
        <div class="wxtos5 animated"><img src="img/wxtos_12.jpg" /></div>
        <div class="nextIcon nextIcon2 animated infinite">
            <img src="img/nextIcon.png" />
        </div>

        <div  class="wxbot"><img src="img/wxbot.jpg" /></div>
    </div>

    <div class="pages page3-box" style="display:none">
        <div class="p3-p animated fadeInRightBig"><img src="img/p3-p.jpg" /></div>
        <div class="p3-m"><img src="img/p3-m.jpg" /></div>
    </div>

    <!-- 左转直行掉头 -->
    <div class="pages page4_box" style="display:none">
        <section class="page4_box_1">
            <div class="map_line1 ">
                <div class="car">
                    <div class="line animated fadeIn"></div>
                    <div class="line animated fadeIn"></div>
                    <div class="line animated fadeIn"></div>
                    <div class="line animated fadeIn"></div>
                </div>
                <div class="girl girl1 animated">                                                                                                                                                         
                
                </div>
                <div class="poster poster1 animated">
                
                </div>
            </div>
            <div class="talk_1 animated">
                <span class="txt animated swing infinite">弯</span>
            </div>
            <div class="talk_2 animated">
                <span class='txt2 animated swing infinite'>禁止左弯</span>
                <span class='txt3 animated swing infinite'>畅通</span>
            </div> 
        </section>
        <!-- <div class="nextIcon nextIcon4 animated infinite bounceFde">
            <img src="img/nextIcon.png" />
        </div> -->
    </div>

    <div class="pages page4_box" style="display:none">
        <section class="page4_box_2">
            <div class="map_line2">
                <div class="car">
                    <div class="line animated fadeIn"></div>
                    <div class="line animated fadeIn"></div>
                </div>
                <div class="girl girl2 animated ">
                
                </div>
                <div class="poster poster2 animated ">
                
                </div>
            </div>
            <div class=" talk_3 animated">
                <span class="animated swing infinite">东西</span>
                <span class="animated swing infinite">畅通无阻</span>
            </div>
            <div class="talk_1 talk_4  animated">
                <span class="animated swing infinite">横行霸道</span>
            </div> 
        </section>
        <!-- <div class="nextIcon nextIcon5 animated infinite bounceFde">
            <img src="img/nextIcon.png" />
        </div> -->
    </div>
    <div class="pages page4_box" style="display:none">
        <section  class="page4_box_3">
            <div class="map_line1 map_line3">
                <div class="line animated fadeIn"></div>
                <div class="girl girl3 animated">
                
                </div>
                <div class="poster poster3 animated">
                
                </div>
            </div>
            <div class=" talk_1  talk_5 animated ">
                <span  class="animated swing infinite txt2">不回头</span><span  class="animated swing infinite">快了不少</span>
            </div>
            <div class="talk_1 talk_6 animated ">
            </div>
            <div class="talk_1 talk_7 animated ">      
            </div> 
        </section>
        <!-- <div class="nextIcon nextIcon6 animated infinite bounceFde">
            <img src="img/nextIcon.png" />
        </div> -->
    </div>

    <div class="pages page5_box"  style="display:none">
        <section class="page5_box1">
            <h1 class="tit">
                <img src="img/kuaip.png" />
                <span class="animated-s infinite shake"></span>
            </h1>
            <div class="talk">
                <p>
                    <span class="animated  pulse-s">不!</span>
                    <span class="animated  pulse-s">再!</span>
                    <span class="animated  pulse-s">拥!</span>
                    <span class="animated  pulse-s">堵!</span>
                </p>
            </div>
            <div class="pic">
                
            </div>
        </section>
        <div class="nextIcon nextIcon7 animated infinite bounceFde">
            <img src="img/nextIcon.png" />
        </div>
    </div>
    <div class="pages page5_box" style="display:none">    
        <section class="page5_box2">
            <div class="house"></div>
            <div class="talk">
                <p>
                    <span class="animated swing infinite">快</span>
                    <span class="animated swing infinite">停</span>
                    <span class="animated swing infinite">车路线</span>
                </p>
            </div>
            <div class="btn nextIcon8">
                <div class='hand'></div>
            </div>
            
        </section>
    </div>
    <p class="maptitle" style="display:none">
        <img src="img/maptitle.jpg" />
    </p>
    <div class="pages page9-box" style="display:none">
        
        <canvas id="canvas" width='310' height='350'></canvas>
        <div class="direction direction1">
            <img src="img/dire_07.png" />
        </div>
        <div class="direction direction2">
            <img src="img/dire_07.png" />
        </div>
        <div class="direction direction3">
            <img src="img/dire_03.png" />
        </div>

        <div class="direction direction4">
            <img src="img/dire_15.png" />
        </div>

        <div class="direction direction5">
            <img src="img/dire_18.png" />
        </div>

        <p class="fh" data-key="index">
            <img src="img/return.jpg" class="ret" />
            <img src="img/grp.jpg" class="grp" />
        </p>
    </div>
</div>

</body>
<script type="text/javascript" src="js/zepto.js"></script>
<script type="text/javascript" src="js/slider.js"></script>
<script type="text/javascript" src="js/data.js"></script>
<script type="text/javascript">
    $(window).on('touchmove',function(e){
        e.preventDefault();
    })
    $('.maptitle').hide();
    setTimeout(function(){
        $('.page1-text').css('visibility','visible').addClass('fadeIn');
    },1100)
    var slider = new Slider({
        wrap : $('.slider-wrap'),
        type : 'touch',
        callback : function(){
            $('.maptitle').hide();
            if(slider.getIndex()==0){
                for(var i = 1;i<6;i++){
                    $('.wxtos'+i).removeClass('fadeInRightBig').hide()
                    $('.wxtos'+i).removeClass('fadeInLeftBig').hide()
                }
                $('.nextIcon2').removeClass('bounceFde').hide()

            }else if(slider.getIndex()==1){
                slider._lock = true;
                p2();
            }else if(slider.getIndex()==2){
                slider._lock = true;
                for(var i = 1;i<6;i++){
                    $('.wxtos'+i).removeClass('fadeInRightBig').hide()
                    $('.wxtos'+i).removeClass('fadeInLeftBig').hide()
                }
                $('.nextIcon2').removeClass('bounceFde').hide()
                $('.girl1').hide().removeClass('pulse');
                $('.poster1').hide().removeClass('pulse');

                $('.talk_1').hide().addClass('fadeInLeftBig')
                $('.talk_2').hide().addClass('fadeInRightBig')

                $('.p3-m').on('click',function(){
                    slider._start(3);
                    setTimeout(function(){
                        $('.girl1').show().addClass('pulse');
                        $('.poster1').show().addClass('pulse');
                        $('.talk_1').show().addClass('fadeInLeftBig')
                        $('.talk_2').show().addClass('fadeInRightBig')
                        slider._lock = false;
                    },3000)
                })
            }else if(slider.getIndex()==3){
                slider._lock = true;
                $('.girl2').hide().removeClass('pulse');
                $('.poster2').hide().removeClass('pulse');
                $('.talk_3').hide().removeClass('fadeInLeftBig')
                $('.talk_4').hide().removeClass('fadeInRightBig')
                setTimeout(function(){
                    $('.girl1').show().addClass('pulse');
                    $('.poster1').show().addClass('pulse');
                    $('.talk_1').show().addClass('fadeInLeftBig')
                    $('.talk_2').show().addClass('fadeInRightBig')
                    slider._lock = false;
                },3000)

            }else if(slider.getIndex()==4){
                slider._lock = true;
                $('.girl1').hide().removeClass('pulse');
                $('.poster1').hide().removeClass('pulse');

                $('.girl3').hide().removeClass('pulse');
                $('.poster3').hide().removeClass('pulse');
                $('.talk_1').hide().removeClass('fadeInLeftBig')
                $('.talk_2').hide().removeClass('fadeInRightBig')
                $('.talk_5').hide().removeClass('fadeInLeftBig')
                $('.talk_6').hide().removeClass('fadeInRightBig')
                $('.talk_7').hide().removeClass('fadeInLeftBig')

                setTimeout(function(){
                    $('.girl2').show().addClass('pulse');
                    $('.poster2').show().addClass('pulse');
                    $('.talk_3').show().addClass('fadeInLeftBig')
                    $('.talk_4').show().addClass('fadeInRightBig')
                    slider._lock = false;
                },3000)
            }else if(slider.getIndex()==5){
                slider._lock = true;
                $('.girl2').hide().removeClass('pulse');
                $('.poster2').hide().removeClass('pulse');
                $('.talk_3').hide().removeClass('fadeInLeftBig')
                $('.talk_4').hide().removeClass('fadeInRightBig')
                setTimeout(function(){
                    $('.girl3').show().addClass('pulse');
                    $('.poster3').show().addClass('pulse');
                    $('.talk_5').show().addClass('fadeInLeftBig')
                    $('.talk_6').show().addClass('fadeInRightBig')
                    $('.talk_7').show().addClass('fadeInLeftBig')
                    slider._lock = false;
                },3000)
            }else if(slider.getIndex()==6){
                $('.girl3').hide().removeClass('pulse');
                $('.poster3').hide().removeClass('pulse');
                $('.talk_5').hide().removeClass('fadeInLeftBig')
                $('.talk_6').hide().removeClass('fadeInRightBig')
                $('.talk_7').hide().removeClass('fadeInLeftBig')
            }else if(slider.getIndex()==7){
                $('.nextIcon8').on('click',function(){
                    slider._start(8);
                    var width = ($(window).width()-$('#canvas').width())/2,
                    height = ($(window).height()-$('#canvas').height())/2;
                    $('.page9-box').css('top',height)    

                    $('#canvas').css('left',width);

                    $('.fh').css('left',width);

                    $('.direction1,.direction2').css('left',width)

                    $('.direction3,.direction4').css('right',width-8)

                    $('.direction5').css('right',width+113);
                })

            }else if(slider.getIndex()==8){
                var width = ($(window).width()-$('#canvas').width())/2,
                height = ($(window).height()-$('#canvas').height())/2;
                $('.page9-box').css('top',height)    

                $('#canvas').css('left',width);

                $('.fh').css('left',width);

                $('.direction1,.direction2').css('left',width)

                $('.direction3,.direction4').css('right',width-8)

                $('.direction5').css('right',width+113);
            }
        }
    })
    var times;
    times = setInterval(function(){
        console.log(slider._idx)
        if(slider._idx==8){
            clearInterval(times)
            $('.maptitle').show();
        }
    },100)
    var myAudio = document.getElementById("myAudio");
    myAudio.play();
    var myAudioWx = document.getElementById("myAudioWx");
    

    // $('.nextIcon').on('click',function(){

    //     $(this).parent().hide().next().show();
    //     if($(this).attr('class').indexOf('nextIcon1')>0){
    //         p2();
    //     }else if($(this).attr('class').indexOf('nextIcon4')>0){
    //         setTimeout(function(){
    //             $('.girl2').show().addClass('pulse');
    //             $('.poster2').show().addClass('pulse');
    //         },3000)
    //     }else if($(this).attr('class').indexOf('nextIcon5')>0){
    //         setTimeout(function(){
    //             $('.girl3').show().addClass('pulse');
    //             $('.poster3').show().addClass('pulse');
    //         },3000)
    //     }

    // })
    // $('.nextIcon8').on('click',function(){
    //     $(this).parent().parent().hide().next().show();

    // })


    // p2
    function p2(){
        var i = 1,timer;
        function wxTos(i){
            (i==4) && 
            ($('.wxtos'+i).show().addClass('fadeInRightBig'),setTimeout(function(){$('.nextIcon').show().addClass('bounceFde')},3200)) || 
            ($('.wxtos'+i).show().addClass('fadeInLeftBig'));
            if(i==5){
                slider._lock = false;
            }
            setTimeout(function(){
                myAudioWx.play();
            },600)
        }
        timer = setInterval(function(){
            if(i>=4){
                clearInterval(timer)
            }
            i++;
            wxTos(i);
        },1600)
        wxTos(1);
    }

    // canvas

    var canvas = document.getElementById('canvas'),
        context = canvas.getContext('2d');
    var s = 0;
    function line(arr,num){
        s = 0;
        arr = arr;
        timer = setTimeout(function(){
            num++;
            if(num >= arr.length){
                clearTimeout(timer);
                return false;
            };
            
            line(arr,num);
        },600)
        timer2 = setInterval(function(){
            s+=1;
            if(s==10){
                clearTimeout(timer2)
            }
            context.strokeStyle='#f00';
            context.lineWidth=2;
            context.lineCap='square';
            context.beginPath();
            if(arr[num].toX == 0){
                
                context.moveTo(arr[num].moveX,arr[num].moveY);
                context.lineTo(arr[num].moveX,arr[num].moveY-(arr[num].toY)/10*s);
            }else{
                context.moveTo(arr[num].moveX,arr[num].moveY);
                context.lineTo((arr[num].toX)/10*s+arr[num].moveX,arr[num].moveY);

            }
            context.stroke();
            context.closePath();
        },50)
    }
    
    var lock = true;

    $('.direction').on('click',function(){
        $(this).siblings('div').hide();
        $('.fh').attr('data-key','reload');
        var index = $(this).index();
        switch(index){
            case 1 :
                line(arr1,0);
            break;
            case 2 :
                line(arr2,0);
            break;
            case 3 :
                line(arr3,0);
            break;
            case 4 :
                line(arr4,0);
            break;
            case 5 :
                line(arr5,0);
            break;
        }

        if(lock){
            return false;
        }
    })

    $('.fh').on('click',function(){
        var key = $(this).attr('data-key');
        if(key == 'index'){
            window.location.reload()
        }else{
            $('.direction').show();
            context.clearRect(0,0,310,350);
            $(this).attr('data-key','index')
        }
    })
    
</script>
</html>



